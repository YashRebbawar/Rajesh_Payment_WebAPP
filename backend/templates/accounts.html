{% extends "base.html" %}

{% block title %}Account Selection - PrintFree{% endblock %}

{% block content %}
<div class="account-container">
    <div class="account-floating-shapes">
        <div class="account-shape account-shape-1"></div>
        <div class="account-shape account-shape-2"></div>
        <div class="account-shape account-shape-3"></div>
    </div>
    {% if user %}
    <div class="auth-buttons">
        <div class="user-profile-wrapper">
            <button class="profile-icon-btn" id="profile-toggle">
                <div class="profile-icon">{{ (user.name[0] if user.name else user.email[0]).upper() }}</div>
            </button>
            <div class="profile-dropdown" id="profile-dropdown">
                <div class="profile-card-wrapper">
                    <div class="profile-card-main">
                        <div class="profile-card-header">
                            <div class="profile-card-header-left">Trading Account</div>
                            <div class="profile-card-header-right">
                                <div class="profile-time-icon">⏱</div>
                                <span id="current-time"></span>
                            </div>
                        </div>
                        <div class="profile-card-content">
                            <div class="profile-card-avatar">
                                {{ (user.name[0] if user.name else user.email[0]).upper() }}
                            </div>
                            <div class="profile-card-name-block">
                                <div style="display: flex; align-items: center; gap: 6px;" id="name-display">
                                    <h2 id="profile-name-text">{{ user.name if user.name else user.email.split('@')[0] }}</h2>
                                    <button style="background: none; border: none; cursor: pointer; font-size: 14px; color: #000;" onclick="editName()"><i class="fa-solid fa-pencil"></i></button>
                                </div>
                                <div style="display: none; align-items: center; gap: 6px;" id="name-edit">
                                    <input type="text" id="name-input" value="{{ user.name if user.name else user.email.split('@')[0] }}" style="font-size: 18px; font-weight: 700; border: 2px solid #ffed4e; border-radius: 8px; padding: 4px 8px; width: 180px;">
                                    <button style="background: none; border: none; cursor: pointer; font-size: 16px; color: #28a745;" onclick="saveName()">✓</button>
                                    <button style="background: none; border: none; cursor: pointer; font-size: 16px; color: #dc3545;" onclick="cancelEdit()">✕</button>
                                </div>
                                <div class="profile-card-status-row">
                                    <span class="profile-status-dot"></span>
                                    <span>{{ user.email }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="profile-card-actions">
                            <button class="profile-card-btn" onclick="window.location.href='/my-accounts'">
                                <span>My Account</span>
                            </button>
                            <button class="profile-card-btn" onclick="window.location.href='/logout'">
                                <span class="profile-card-btn-icon">▢</span>
                                <span>Log out</span>
                            </button>
                        </div>
                    </div>
                    <div class="profile-intensity-card">
                        <span>Account Type:</span>
                        <span>Standard</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <button type="button" class="back-button" id="back-button" aria-label="Go back">
        <span class="back-icon">←</span>
       
    </button>
    <div class="header-section">
        <h1 class="account-title">Open New Account</h1>
        <p class="subtitle-text">
            Choose the account type that best fits your trading style and start your journey with professional trading conditions
        </p>
    </div>

    <div class="account-grid">
        <div class="account-card popular" data-id="standard">
            <div class="popular-badge">Popular</div>
            <div class="card-header">
                <h2>Standard</h2>
                <div class="subtitle">Recommended</div>
                <p class="description">Most popular! A great account for all types of traders</p>
            </div>
            <div class="card-details">
                <div class="detail-row">
                    <span class="label">Min. deposit</span>
                    <span class="value">10 USD</span>
                </div>
                <div class="detail-row">
                    <span class="label">Spread</span>
                    <span class="value">From 0.20</span>
                </div>
                <div class="detail-row">
                    <span class="label">Commission</span>
                    <span class="value">No commission</span>
                </div>
            </div>
        </div>

        <div class="account-card" data-id="pro">
            <div class="card-header">
                <h2>Pro</h2>
                <div class="subtitle">Instant or market execution</div>
                <p class="description">Zero commission and low spreads with both instant or market execution.</p>
            </div>
            <div class="card-details">
                <div class="detail-row">
                    <span class="label">Min. deposit</span>
                    <span class="value">500 USD</span>
                </div>
                <div class="detail-row">
                    <span class="label">Spread</span>
                    <span class="value">From 0.10</span>
                </div>
                <div class="detail-row">
                    <span class="label">Commission</span>
                    <span class="value">No commission</span>
                </div>
            </div>
        </div>

        <div class="account-card" data-id="raw-spread">
            <div class="card-header">
                <h2>Raw spread</h2>
                <div class="subtitle">Professional</div>
                <p class="description">Low raw spreads and a low fixed commission</p>
            </div>
            <div class="card-details">
                <div class="detail-row">
                    <span class="label">Min. deposit</span>
                    <span class="value">500 USD</span>
                </div>
                <div class="detail-row">
                    <span class="label">Spread</span>
                    <span class="value">From 0.00</span>
                </div>
                <div class="detail-row">
                    <span class="label">Commission</span>
                    <span class="value">To 3.50 USD</span>
                </div>
            </div>
        </div>

        <div class="account-card" data-id="zero">
            <div class="best-badge">Best</div>
            <div class="card-header">
                <h2>Zero</h2>
                <div class="subtitle">Professional</div>
                <p class="description">Get 0 spreads for 95% of the day on 30 pairs</p>
            </div>
            <div class="card-details">
                <div class="detail-row">
                    <span class="label">Min. deposit</span>
                    <span class="value">500 USD</span>
                </div>
                <div class="detail-row">
                    <span class="label">Spread</span>
                    <span class="value">Best</span>
                </div>
                <div class="detail-row">
                    <span class="label">Commission</span>
                    <span class="value">From 0.20 USD</span>
                </div>
            </div>
        </div>
    </div>

    <div class="action-section" id="action-section" style="display: none;">
        <button class="open-button" id="open-button">Open Account</button>
        <p class="action-note">Your account will be ready in minutes</p>
    </div>
</div>

<script>
function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
    const timeEl = document.getElementById('current-time');
    if (timeEl) timeEl.textContent = timeStr;
}
updateTime();
setInterval(updateTime, 60000);

document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.account-card');
    const actionSection = document.getElementById('action-section');
    const openButton = document.getElementById('open-button');
    const backButton = document.getElementById('back-button');
    let selectedCard = null;

    cards.forEach(card => {
        card.addEventListener('click', function() {
            cards.forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            selectedCard = this;
            
            const accountType = this.querySelector('h2').textContent;
            openButton.textContent = `Open ${accountType} Account`;
            actionSection.style.display = 'block';
        });
    });

    openButton.addEventListener('click', function() {
        if (selectedCard) {
            const accountId = selectedCard.dataset.id;
            window.location.href = `/account-setup/${accountId}`;
        }
    });

    if (backButton) {
        backButton.addEventListener('click', function() {
            window.history.back();
        });
    }

    const profileToggle = document.getElementById('profile-toggle');
    const profileDropdown = document.getElementById('profile-dropdown');
    
    if (profileToggle) {
        profileToggle.addEventListener('click', function() {
            profileDropdown.classList.toggle('active');
        });
    }

    document.addEventListener('click', function(e) {
        const wrapper = document.querySelector('.user-profile-wrapper');
        if (wrapper && !wrapper.contains(e.target)) {
            profileDropdown?.classList.remove('active');
        }
    });
});

function editName() {
    document.getElementById('name-display').style.display = 'none';
    document.getElementById('name-edit').style.display = 'flex';
    document.getElementById('name-input').focus();
}

function cancelEdit() {
    document.getElementById('name-display').style.display = 'flex';
    document.getElementById('name-edit').style.display = 'none';
}

async function saveName() {
    const newName = document.getElementById('name-input').value.trim();
    if (!newName) return;
    
    try {
        const response = await fetch('/api/update-name', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name: newName})
        });
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('profile-name-text').textContent = newName;
            document.querySelector('.profile-card-avatar').textContent = newName[0].toUpperCase();
            document.querySelector('.profile-icon').textContent = newName[0].toUpperCase();
            cancelEdit();
        }
    } catch (error) {
        console.error('Error updating name:', error);
    }
}
</script>
{% endblock %}
