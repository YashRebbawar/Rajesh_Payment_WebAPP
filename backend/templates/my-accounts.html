{% extends "base.html" %}

{% block title %}My accounts - PrintFree{% endblock %}

{% block content %}
<header class="main-header">
    <div class="header-content">
        <a href="/" class="header-logo">
            <img src="{{ url_for('static', filename='images/Printfree_logo.png') }}" alt="PrintFree Logo">
            <span>PrintFree</span>
        </a>
        <nav class="header-nav">
            <button class="nav-toggle" id="nav-toggle">☰</button>
            
            {% if user %}
            <div class="user-profile-wrapper">
                <button class="profile-icon-btn" id="profile-toggle">
                    <div class="profile-icon">{{ (user.name[0] if user.name else user.email[0]).upper() }}</div>
                </button>
                <div class="profile-dropdown" id="profile-dropdown">
                    <div class="profile-card-wrapper">
                        <div class="profile-card-main">
                            <div class="profile-card-header">
                                <div class="profile-card-header-left">Trading Account</div>
                                <div class="profile-card-header-right">
                                    <div class="profile-time-icon">⏱</div>
                                    <span id="current-time"></span>
                                </div>
                            </div>
                            <div class="profile-card-content">
                                <div class="profile-card-avatar">
                                    {{ (user.name[0] if user.name else user.email[0]).upper() }}
                                </div>
                                <div class="profile-card-name-block">
                                    <div style="display: flex; align-items: center; gap: 6px;" id="name-display">
                                        <h2 id="profile-name-text">{{ user.name if user.name else user.email.split('@')[0] }}</h2>
                                        <button style="background: none; border: none; cursor: pointer; font-size: 14px; color: #000;" onclick="editName()"><i class="fa-solid fa-pencil"></i></button>
                                    </div>
                                    <div style="display: none; align-items: center; gap: 6px;" id="name-edit">
                                        <input type="text" id="name-input" value="{{ user.name if user.name else user.email.split('@')[0] }}" style="font-size: 18px; font-weight: 700; border: 2px solid #ffed4e; border-radius: 8px; padding: 4px 8px; width: 180px;">
                                        <button style="background: none; border: none; cursor: pointer; font-size: 16px; color: #28a745;" onclick="saveName()">✓</button>
                                        <button style="background: none; border: none; cursor: pointer; font-size: 16px; color: #dc3545;" onclick="cancelEdit()">✕</button>
                                    </div>
                                    <div class="profile-card-status-row">
                                        <span class="profile-status-dot"></span>
                                        <span>{{ user.email }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-card-actions">
                                <button class="profile-card-btn" onclick="window.location.href='/my-accounts'">
                                    <span>My Account</span>
                                </button>
                                <button class="profile-card-btn" onclick="window.location.href='/logout'">
                                    <span class="profile-card-btn-icon">▢</span>
                                    <span>Log out</span>
                                </button>
                            </div>
                        </div>
                        <div class="profile-intensity-card">
                            <span>Account Type:</span>
                            <span>Standard</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </nav>
    </div>
</header>

<div class="my-accounts-container">
    <div class="my-accounts-header">
        <h1>My accounts</h1>
        <button class="open-account-btn" onclick="window.location.href='/accounts'">
            <span>+</span> Open account
        </button>
    </div>

    {% if accounts %}
    <div class="filter-section">
        <select class="sort-dropdown">
            <option>Newest</option>
            <option>Oldest</option>
            <option>Balance (High to Low)</option>
            <option>Balance (Low to High)</option>
        </select>
        <div class="view-toggle">
            <button class="view-btn active" data-view="list">☰</button>
            <button class="view-btn" data-view="grid">⊞</button>
        </div>
    </div>


    <div class="accounts-list">
        {% for account in accounts %}
        <div class="account-card">
            <div class="account-header">
                <div class="account-badges">
                    <span class="badge">Real</span>
                    <span class="badge">{{ account.platform }}</span>
                    <span class="badge">{{ account.account_type|replace('-', ' ')|title }}</span>
                    <span class="badge">{{ account.nickname }}</span>
                </div>
            </div>
            <div class="account-balance">
                <div class="balance-amount">{{ account.balance|default(0.00, true)|round(2) }}</div>
                <div class="balance-currency">{{ account.currency }}</div>
            </div>
            <div class="account-details">
                <div class="detail-row">
                    <span>Actual leverage</span>
                    <span>{{ account.leverage }}</span>
                </div>
                <div class="detail-row">
                    <span>Free margin</span>
                    <span>0.00 {{ account.currency }}</span>
                </div>
                <div class="detail-row">
                    <span>Adjust leverage</span>
                    <span>{{ account.leverage }}</span>
                </div>
                <div class="detail-row">
                    <span>Equity</span>
                    <span>0.00 {{ account.currency }}</span>
                </div>
                <div class="detail-row">
                    <span>Floating P/L</span>
                    <span>0.00 {{ account.currency }}</span>
                </div>
                <div class="detail-row">
                    <span>Platform</span>
                    <span>{{ account.platform }}</span>
                </div>
            </div>
            <div class="account-footer">
                <div class="footer-info">
                    <span>Server</span>
                    <span>Exness-{{ account.platform }}Real{{ loop.index }}</span>
                </div>
                <div class="footer-info">
                    <span>{{ account.platform }} login</span>
                    <span>{{ account._id }}</span>
                </div>
                <button class="change-password-btn">Change trading password</button>
            </div>
            <div class="account-actions">
                <button class="action-btn deposit-btn" data-account-id="{{ account._id }}">Deposit</button>
                <button class="action-btn withdraw-btn" data-account-id="{{ account._id }}">Withdraw</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <img src="{{ url_for('static', filename='images/folder_icon.png') }}" alt="No accounts" class="empty-icon">
        <p class="empty-text">No active accounts</p>
        <button class="open-account-btn-yellow" onclick="window.location.href='/accounts'">Open account</button>
    </div>
    {% endif %}
</div>

<footer class="footer-links">
    <a href="#">Client Agreement</a>
    <a href="#">General Business Terms</a>
</footer>

<script src="{{ url_for('static', filename='js/my-accounts.js') }}"></script>
{% endblock %}
